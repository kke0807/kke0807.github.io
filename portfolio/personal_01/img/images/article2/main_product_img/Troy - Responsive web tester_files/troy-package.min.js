!function(o){o.Troy=o.Troy||{}}(this);$(function(){var e=Backbone.Model.extend({idAttribute:"deviceId",defaults:{brand:"",model:"",displayWidth:0,displayHeight:0,dpi:0,statusBarHeight:0,hasNavigationBar:!1,navigationBarHeight:0,supportTransparentBar:!0,image:"",_screenRotation:"portrait",_url:"",_isXframeEnabled:!1,_hideAddressBar:$.cookie("TROY_HIDE_ADDRESSBAR")?"true"==$.cookie("TROY_HIDE_ADDRESSBAR"):!0}});Troy.DeviceModel=e});$(function(){var e=Troy.DeviceModel,o=Backbone.Collection.extend({model:e,url:"/device"});Troy.DeviceCollection=o});$(function(){var e=Backbone.View.extend({events:{"click .rotate":"rotateClickHandler","click .close":"remove",mouseenter:"highlightItem",mouseleave:"dehighlightItem","submit .browser-address-form":"browserURLSubmitHandler","click .reload:not(.disabled)":"reloadClickHandler","focus input[type='url']":"urlFocusHandler","blur input[type='url']":"urlBlurHandler","keydown input[type='url']":"urlKeydownHandler","mousedown .url-list > a":"visitedUrlClickHandler","mousedown .hide-address":"hideAddressBar","click .show-address":"showAddressBar"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","highlight","dehighlight","renderScreen","browserURLSubmitHandler","visitedUrlClickHandler","toggleAddressBar"),this.portraitViewTemplate=_.template($("#portraitViewTemplate").html()),this.landscapeViewTemplate=_.template($("#landscapeViewTemplate").html()),this.isVisible=!1},render:function(){this.delegateEvents(),this.renderScreen(),this.$el.addClass("device-view-wrapper"),this.$el.attr("data-hide-address",this.item.model.get("_hideAddressBar")),this.item.list.app.$el.find("#view-wrapper").append(this.$el),this.item.model.set("_isSelected",!0),this.isVisible=!0},renderScreen:function(){var e=this.item.model.toJSON();e._url=escapeHtml(e._url),"portrait"==e._screenRotation?this.$el.html(this.portraitViewTemplate(e)):this.$el.html(this.landscapeViewTemplate(e)),this.$el.attr("data-rotation",e._screenRotation)},browserURLSubmitHandler:function(e){var t,i=this.$el.find("input[type='url']");if(t="string"==typeof e?$.trim(e):$.trim(i.val()),!t.length)return i.focus(),!1;var s=/^https?:\/\/((www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,4}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)|localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/i,l=new RegExp(s);return t=t.match(l)?t:"http://"+t,this.$el.find(".reload").toggleClass("disabled",!t.length),i.val(t),i.blur(),this.item.list.app.setURLHistory(t),this.item.model.set({_url:t,_isXframeEnabled:!1}),!1},reloadClickHandler:function(e){this.renderScreen(),$(e.currentTarget).addClass("disabled")},remove:function(){this.$el.remove(),this.item.dehighlight(),this.item.model.unset("_isSelected"),this.isVisible=!1},highlight:function(){this.$el.addClass("highlight")},dehighlight:function(){this.$el.removeClass("highlight")},highlightItem:function(){this.highlight(),this.item.highlight()},dehighlightItem:function(){this.dehighlight(),this.item.dehighlight()},rotateClickHandler:function(){this.dehighlight(),this.item.model.set({_screenRotation:"portrait"==this.item.model.get("_screenRotation")?"landscape":"portrait"})},urlFocusHandler:function(e){var t=this,i=$.cookie("TROY_VISITED_URL")?$.cookie("TROY_VISITED_URL").split(";"):["http://m.daum.net"];return i.length<1?!1:(this.urlList=this.urlList||$(document.createElement("div")).addClass("url-list"),this.urlList.html(""),i.forEach(function(e){e.length&&t.urlList.append("<a href='javascript:;'><span class='glyphicon glyphicon-time'></span> &nbsp;<span class='urltext'>"+e+"</span></a>")}),void this.urlList.appendTo(this.$el.find(".browser-address-form")))},urlBlurHandler:function(){this.urlList&&this.urlList.remove()},urlKeydownHandler:function(e){var t=e.which;if(38!=t&&40!=t||!this.urlList)return!0;var i,s=this.urlList.find(".on");40==t?i=s.length?s.next():this.urlList.find("a:first-child"):38==t&&(i=s.prev()),i.length&&(s.removeClass("on"),i.addClass("on"),this.$el.find("input[type='url']").val(i.find(".urltext").text()),this.$el.find(".url-list").scrollTop(this.$el.find(".url-list").scrollTop()+i.position().top-150))},visitedUrlClickHandler:function(e){this.browserURLSubmitHandler($(e.currentTarget).find(".urltext").text())},hideAddressBar:function(){this.item.model.set("_hideAddressBar",!0)},showAddressBar:function(){this.item.model.set("_hideAddressBar",!1)},toggleAddressBar:function(){this.$el.find("input[type='url']").blur(),this.$el.attr("data-hide-address",this.item.model.get("_hideAddressBar"))}});Troy.DeviceView=e});$(function(){var e=Troy.DeviceView,i=Backbone.View.extend({tagName:"li",events:{"click .device":"loadDevice",mouseenter:"highlightView",mouseleave:"dehighlightView"},initialize:function(e){_.extend(this,e),_.bindAll(this,"loadDevice","selectedChangeHandler","screenRotationChangeHandler","urlChangeHandler","hideAddressBarChangeHandler"),this.template=_.template($("#deviceItemTemplate").html()),this.model.item=this,this.model.set("_scrollbarWidth",this.list.app.setting.adjustScrollbarWidth===!0?this.list.app.setting.scrollbarWidth:0),this.model.on({"change:_url":this.urlChangeHandler,"change:_isSelected":this.selectedChangeHandler,"change:_screenRotation":this.screenRotationChangeHandler,"change:_scrollbarWidth":this.screenRotationChangeHandler,"change:_hideAddressBar":this.hideAddressBarChangeHandler}),this.render()},render:function(){this.$el.html(this.template(this.model.toJSON()))},loadDevice:function(){this.view=this.view||new e({item:this}),this.list.enabledMultiView===!1&&this.list.lastRenderedDevice&&this.list.lastRenderedDevice.view.remove(),this.view.isVisible?this.view.remove():(this.view.render(),this.list.lastRenderedDevice=this,this.scrollPosition())},scrollPosition:function(){var e=this.list.app.$el.find("#page-wrapper"),i=e.scrollTop(),t=i+this.view.$el.position().top;e.stop().animate({scrollTop:t-200})},selectedChangeHandler:function(){this.$el.find(".selected").toggle(this.model.has("_isSelected"))},highlight:function(){this.$el.addClass("highlight")},dehighlight:function(){this.$el.removeClass("highlight")},highlightView:function(){this.view&&this.view.isVisible&&this.view.highlight()},dehighlightView:function(){this.view&&this.view.isVisible&&this.view.dehighlight()},screenRotationChangeHandler:function(){this.view&&this.view.isVisible&&this.view.renderScreen()},urlChangeHandler:function(){this.view&&this.view.isVisible&&this.view.renderScreen()},hideAddressBarChangeHandler:function(){this.view&&this.view.isVisible&&this.view.toggleAddressBar()}});Troy.DeviceItem=i});$(function(){var e=Troy.DeviceCollection,i=Troy.DeviceItem,t=Backbone.View.extend({initialize:function(i){_.extend(this,i),_.bindAll(this,"render","append","changeScreenURL","renderQueriedDevice"),this.brandTemplate=_.template($("#deviceBrandTemplate").html()),this.enabledMultiView=$.cookie("TROY_ENABLE_MULTI_SCREEN")?"true"==$.cookie("TROY_ENABLE_MULTI_SCREEN"):!0,this.lastRenderedView,this.collection=new e,this.collection.on("reset",this.render),this.collection.fetch({reset:!0})},render:function(){this.collection.each(this.append),this.$el.metisMenu(),this.renderQueriedDevice(),this.app.setting.initSplashDevice()},append:function(e){this.$el.find("li[data-brand='"+e.get("brand")+"']").length<1&&this.$el.append(this.brandTemplate({brand:e.get("brand")})),e.set("_url",this.app.getUrl());var t=new i({model:e,list:this});this.$el.find("li[data-brand='"+e.get("brand")+"'] .device-list").append(t.$el)},changeScreenURL:function(e,i){this.collection.each(function(t){t.get("_url")==e&&t.item.view&&t.item.view.isVisible?t.item.view.renderScreen():t.set({_url:e,_isXframeEnabled:i})})},renderQueriedDevice:function(){var e=this,i=this.app.getInitDevice();if(i.length)i.forEach(function(i){var t=0==i.indexOf("@"),n=t?i.replace(/^\@/,""):i,l=n.split("@")[0],a=n.split("@")[1],c=e.collection.get(l);c&&(c.set({_screenRotation:t?"landscape":"portrait"}),a&&c.set({_url:a}),c.item.loadDevice())});else{var t=this.collection.get($.cookie("TROY_SPLASH_DEVICE"))||this.collection.get("ko"==this.app.locale?"N910":"A1549");t.item.loadDevice(),this.$el.find("li[data-brand='"+t.get("brand")+"']").addClass("active").children("ul").addClass("in")}}});Troy.DeviceList=t});$(function(){var l=Backbone.View.extend({events:{"focus #url":"urlFocusHandler","blur #url":"urlBlurHandler","keydown #url":"urlKeydownHandler","submit #urlForm":"urlFormSubmitHandler","mousedown .url-list > a":"visitedUrlClickHandler","click .reload:not(.disabled)":"reloadClickHandler","mouseleave .reload":"reloadLeaveHandler","click .zoom":"stopPropagation","change .zoom input[type='range']":"zoomChangeHandler"},initialize:function(l){_.extend(this,l),_.bindAll(this,"urlFormSubmitHandler","urlFocusHandler","urlBlurHandler","visitedUrlClickHandler","urlKeydownHandler","zoomChangeHandler")},urlFormSubmitHandler:function(l){var r,t=this.$el.find("#url");if(r="string"==typeof l?$.trim(l):$.trim(t.val()),!r.length)return t.focus(),!1;var e=/^https?:\/\/((www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,4}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)|localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/i,i=new RegExp(e);return r=r.match(i)?r:"http://"+r,this.$el.find(".reload").toggleClass("disabled",!r.length),t.val(r),t.blur(),this.app.setURLHistory(r),this.app.deviceList.changeScreenURL(r,!1),!1},urlFocusHandler:function(l){var r=this,t=$.cookie("TROY_VISITED_URL")?$.cookie("TROY_VISITED_URL").split(";"):["http://m.daum.net"];return t.length<1?!1:(this.urlList=this.urlList||$(document.createElement("div")).addClass("url-list"),this.urlList.html(""),t.forEach(function(l){l.length&&r.urlList.append("<a href='javascript:;'><span class='glyphicon glyphicon-time'></span> &nbsp;<span class='urltext'>"+l+"</span></a>")}),void this.urlList.appendTo(this.$el.find("#urlForm")))},urlBlurHandler:function(){this.urlList&&this.urlList.remove()},urlKeydownHandler:function(l){var r=l.which;if(38!=r&&40!=r||!this.urlList)return!0;var t,e=this.urlList.find(".on");40==r?t=e.length?e.next():this.urlList.find("a:first-child"):38==r&&(t=e.prev()),t.length&&(e.removeClass("on"),t.addClass("on"),this.$el.find("#url").val(t.find(".urltext").text()),this.$el.find(".url-list").scrollTop(this.$el.find(".url-list").scrollTop()+t.position().top-150))},visitedUrlClickHandler:function(l){this.urlFormSubmitHandler($(l.currentTarget).find(".urltext").text())},reloadClickHandler:function(l){this.urlFormSubmitHandler(),$(l.currentTarget).addClass("disabled")},reloadLeaveHandler:function(l){$.trim(this.$el.find("#url").val()).length>0&&$(l.currentTarget).removeClass("disabled")},stopPropagation:function(l){l.stopPropagation()},zoomChangeHandler:function(){var l=this.$el.find(".zoom input[type='range']").val(),r=this.app.$el.find("#page-wrapper");this.app.$el.find("#view-wrapper").css({webkitTransform:"scale("+l/100+")",transform:"scale("+l/100+")",width:r.width()/(l/100)})}});Troy.UrlInput=l});$(function(){var e=Backbone.View.extend({events:{"click #shareURL":"inputClickHandler","click #shareURLTextarea":"inputClickHandler","click .get-share":"getShareClickHandler","click .share":"stopPropagation"},initialize:function(e){_.extend(this,e),_.bindAll(this,"getShareClickHandler","getShareURL")},getShareClickHandler:function(){var e=this.getShareURL(),t=this.$el.find("#shareURL");t.val("");var a=this.$el.find("#shareURLTextarea");a.val(e),$.ajax({url:"https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyDGNFHbz7SksqfZQV5exLU_0yulrJpGo14",type:"POST",data:'{"longUrl": "'+e+'"}',dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){if(e&&"string"==typeof e.id){var a=e.id;t.val(a),t.select()}},error:function(e){}})},getShareURL:function(){var e=this,t=location.origin||location.protocol+"//"+location.hostname+(location.port?":"+window.location.port:""),a=[];$.trim(this.app.$el.find("#url").val()).length>0&&a.push("url="+encodeURIComponent(this.app.getUrl()));var n=[],i=this.app.$el.find("[data-device-id]");return i.length>0&&(i.each(function(){var t=$(this).attr("data-device-id"),a=$(this).parent().attr("data-rotation"),i=e.app.deviceList.collection.get(t).get("_url");n.push(encodeURIComponent(("landscape"==a?"@":"")+t)+encodeURIComponent(i!=e.app.getUrl()?"@"+i:""))}),a.push("device="+n.join(";"))),a.length&&(t+="/?"+a.join("&")),t},stopPropagation:function(e){e.stopPropagation()},inputClickHandler:function(e){$(e.currentTarget).select()}});Troy.Share=e});$(function(){var e=Backbone.View.extend({events:{"click .dropdown-tasks":"stopPropagation","change select[name='splashDevice']":"changeSplashDevice","change select[name='locale']":"changeLocale","change select[name='toggle_addressbar']":"changeAddressSetting","click .show-issues":"showIssuesModal","click .show-about":"showAboutModal","change #adjustScrollbar":"changeAdjustScrollbar"},initialize:function(e){_.extend(this,e),_.bindAll(this,"initSplashDevice","detectScrollbarWidth","changeAdjustScrollbar","displayAdjustScrollbar"),this.detectScrollbarWidth()},initSplashDevice:function(){var e=this.app.deviceList.collection,t=$.cookie("TROY_SPLASH_DEVICE"),a=this.$el.find("select[name='splashDevice']");e.each(function(e){var i=$(document.createElement("option"));i.attr("value",e.id).text(e.get("brand")+" "+e.get("model")),e.id==t&&i.attr("selected","selected"),a.append(i)})},changeSplashDevice:function(e){var t=$(e.currentTarget).val();$.cookie("TROY_SPLASH_DEVICE",t,{expires:30})},changeLocale:function(e){var t=$(e.currentTarget).val();location.href="/locale/?locale="+t},changeAddressSetting:function(e){var t=$(e.currentTarget).val();$.cookie("TROY_HIDE_ADDRESSBAR",t,{expires:30}),this.app.deviceList.collection.each(function(e){e.set("_hideAddressBar","true"==t)})},stopPropagation:function(e){e.stopPropagation()},showAboutModal:function(e){this.app.$el.find("#aboutTroy").modal("show"),this.app.$el.click()},showIssuesModal:function(e){this.app.$el.find("#commonIssues").modal("show"),this.app.$el.click()},displayAdjustScrollbar:function(){var e=this.app.$el.find("#page-wrapper .scrollbar-indicator");e.toggle(this.adjustScrollbarWidth)},changeAdjustScrollbar:function(e){var t=this,a=$(e.currentTarget).is(":checked");this.app.deviceList.collection.each(function(e){e.set("_scrollbarWidth",a?t.scrollbarWidth:0)}),$.cookie("TROY_CONSIDER_SCROLLBAR",a,{expires:30}),this.adjustScrollbarWidth=a,this.displayAdjustScrollbar()},detectScrollbarWidth:function(){var e=$(document.createElement("div")).addClass("scrollbar-detector");e.css({width:100,height:100,overflow:"scroll",position:"absolute",top:"-9999px"}),this.app.$el.append(e);var t=e.prop("offsetWidth")-e.prop("clientWidth");e.remove(),t>0&&(this.$el.find(".adjust-scrollbar .checkbox").removeClass("disabled"),this.$el.find(".adjust-scrollbar input[disabled]").removeAttr("disabled"),this.$el.find("#scrollbarWidth").text(t+"px")),this.scrollbarWidth=t;var a=$.cookie("TROY_CONSIDER_SCROLLBAR");a&&a.length>0&&t>0?this.adjustScrollbarWidth="true"==a:t>0?this.adjustScrollbarWidth=!0:this.adjustScrollbarWidth=!1,this.adjustScrollbarWidth&&this.$el.find(".adjust-scrollbar input[type='checkbox']").attr("checked","checked"),this.displayAdjustScrollbar()}});Troy.Setting=e});$(function(){var e=Troy.DeviceList,i=Troy.UrlInput,t=Troy.Share,n=Troy.Setting,o=Backbone.View.extend({events:{"change [data-form-control='toggle'] input":"toggleChangeHandler","change [name='multiscreen']":"multiscreenChangeHandler","click .scrollbar-indicator":"scrollbarIndicatorClickHandler"},initialize:function(o){_.extend(this,o),_.bindAll(this,"initializeScreenEffect","getUrl","multiscreenChangeHandler","scrollbarIndicatorClickHandler"),this.initializeScreenEffect(),this.makeScreenSortable(),this.urlInput=new i({$el:this.$el.find("nav"),app:this}),this.shareAPI=new t({$el:this.$el.find(".menu-share"),app:this}),this.setting=new n({$el:this.$el.find(".menu-setting"),app:this}),this.deviceList=new e({$el:this.$el.find("#side-menu"),app:this})},getInitDevice:function(){var e=this.$el.find("input[name='device']");return e.val()?e.val().split(";"):[]},getUrl:function(){return this.$el.find("#url").val()||"/blank"},initializeScreenEffect:function(){var e=this,i=this.$el.find("nav").height();$(window).bind("load resize",function(){topOffset=50,width=this.window.innerWidth>0?this.window.innerWidth:this.screen.width,$("div.navbar-collapse").removeClass("collapse"),height=this.window.innerHeight>0?this.window.innerHeight:this.screen.height,height-=topOffset,height<1&&(height=1),height>topOffset&&$("#page-wrapper").css("height",height-1+"px"),$(".sidebar").css({height:window.innerHeight-i-1}),e.urlInput.zoomChangeHandler()})},toggleChangeHandler:function(e){var i=$(e.currentTarget);i.parent().prev(".toggle-text").toggleClass("on",i.is(":checked"))},multiscreenChangeHandler:function(e){var i=this,t=$(e.currentTarget).is(":checked");this.deviceList.enabledMultiView=t,$.cookie("TROY_ENABLE_MULTI_SCREEN",t,{expires:30}),t||this.deviceList.collection.each(function(e){e.item.view&&e.item.view.isVisible&&i.deviceList.lastRenderedDevice!=e.item&&e.item.view.remove()})},makeScreenSortable:function(){var e=this.$el.find("#view-wrapper"),i=this.$el.find(".zoom input[type='range']"),t={x:0,y:0};this.$el.find("#view-wrapper").sortable({distance:35,forcePlaceholderSize:!0,start:function(i){e.addClass("ui-sorting"),t.x=i.clientX,t.y=i.clientY},sort:function(n,o){var s=i.val()/100,l=o.originalPosition;o.position={left:(n.clientX-t.x+l.left)/s,top:(n.clientY-t.y+l.top)/s},o.helper.css({left:o.position.left-e.position().left/s,top:o.position.top-e.position().top/s})},stop:function(n,o){e.removeClass("ui-sorting");try{var s=i.val()/100,l=o.originalPosition;o.position={left:(n.clientX-t.x+l.left)/s,top:(n.clientY-t.y+l.top)/s},spotView.model.save({spot_left:o.position.left,spot_top:o.position.top},{patch:!0})}catch(r){}}})},scrollbarIndicatorClickHandler:function(){var e=this;setTimeout(function(){e.setting.$el.find(".dropdown-toggle").dropdown("toggle"),e.setting.$el.find(".adjust-scrollbar").addClass("highlight"),setTimeout(function(){e.setting.$el.find(".adjust-scrollbar").removeClass("highlight")},500)},10)},setURLHistory:function(e){var i=$.cookie("TROY_VISITED_URL")?$.cookie("TROY_VISITED_URL").split(";"):[];i.indexOf(e)>-1&&i.splice(i.indexOf(e),1),i.unshift(e),i=i.slice(0,20),$.cookie("TROY_VISITED_URL",i.join(";"),{expires:30})}});Troy.App=o});